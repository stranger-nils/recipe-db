<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shopping List</title>
</head>
<body>
    <p><a href="{{ url_for('index') }}">‚Üê Back to gallery</a></p>
    <h1>Shopping List</h1>
    <h2>Selected Recipes</h2>
    <ul>
        {% for item in recipes %}
        <li>
            {{ item.recipe['title'] }} (x{{ item.qty }})
            <form action="{{ url_for('update_shopping_list', recipe_id=item.recipe['id'], action='increase') }}" method="post" style="display:inline;">
                <button type="submit">+</button>
            </form>
            <form action="{{ url_for('update_shopping_list', recipe_id=item.recipe['id'], action='decrease') }}" method="post" style="display:inline;">
                <button type="submit">-</button>
            </form>
            <form action="{{ url_for('remove_from_shopping_list', recipe_id=item.recipe['id']) }}" method="post" style="display:inline;">
                <button type="submit">Remove</button>
            </form>
        </li>
        {% endfor %}
    </ul>
    <h2>Shopping List</h2>
    <table border="1" cellpadding="4" id="shopping-table" style="width:100%;">
        <tr>
            <th>Ingredient</th>
            <th>Grocery Category</th>
            <th>Amount</th>
            <th>Unit</th>
            <th>Got it?</th>
        </tr>
        {% set last_staple = None %}
        {% for (name, unit, grocery_category, kitchen_staple), amount in sorted_items %}
            {% if last_staple is not none and last_staple != kitchen_staple %}
                <tr><td colspan="5" style="border-top: 5px solid #333;"></td></tr>
            {% endif %}
            <tr>
                <td>{{ name }}</td>
                <td>{{ grocery_category or '' }}</td>
                <td>{{ amount }}</td>
                <td>{{ unit }}</td>
                <td style="text-align: center;">
                    <input type="checkbox" class="got-checkbox" {% if kitchen_staple %}checked{% endif %}>
                </td>
            </tr>
            {% set last_staple = kitchen_staple %}
        {% endfor %}
    </table>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.got-checkbox').forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                if (checkbox.checked) {
                    checkbox.closest('tr').style.backgroundColor = '#d4f7d4';
                } else {
                    checkbox.closest('tr').style.backgroundColor = '';
                }
            });
            // Pre-check coloring for kitchen staples
            if (checkbox.checked) {
                checkbox.closest('tr').style.backgroundColor = '#d4f7d4';
            }
        });
    });
    </script>
</body>
</html>