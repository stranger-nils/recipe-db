<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recipe Gallery</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .filter-container { margin-bottom: 20px; }
        .recipe-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .card { border: 1px solid #ccc; border-radius: 5px; padding: 10px; }
        img { width: 100%; border-radius: 5px; }
        .tag-label { margin-right: 10px; }
        .image-square {
            width: 300px;           /* Set your desired square size */
            height: 300px;
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #eee;
        }
        .image-square img {
            width: 100%;
            height: 100%;
            object-fit: cover;      /* This crops and centers the image */
            object-position: center;
            display: block;
        }
    </style>
</head>
<body>

<div style="display: flex; gap: 20px;">
    <!-- Left: Recipe gallery -->
    <div style="flex: 2;">
        <h1>Nils's Cookbook</h1>
        <a href="{{ url_for('new_recipe') }}" style="display:inline-block; margin-bottom:20px; padding:10px 20px; background:#4CAF50; color:white; border-radius:5px; text-decoration:none;">âž• New Recipe</a>

        <form method="get" class="filter-container">
            <strong>Filter by tags:</strong><br>
            {% for tag in ['chicken', 'asian', 'swedish', 'vegetarian', 'quick', 'potato', 'meat'] %}
                <label class="tag-label">
                    <input type="checkbox" name="tag" value="{{ tag }}"
                        {% if tag in selected_tags %}checked{% endif %}>
                    {{ tag }}
                </label>
            {% endfor %}
            <br><br>
            <button type="submit">Apply Filters</button>
            <a href="/" style="margin-left: 10px;">Clear</a>
        </form>

        <div class="recipe-grid">
            {% for recipe in recipes %}
            <a href="/recipe/{{ recipe[0] }}">
                <div class="recipe-card">
                    <h3>{{ recipe[1] }}</h3>
                    <div class="image-square">
                        <img src="{{ recipe[5] or 'https://via.placeholder.com/250x150?text=No+Image' }}" alt="Image of {{ recipe[1] }}">
                    </div>
                    <p>{{ recipe[2] }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Right: AI chat -->
    <div style="flex: 1; max-width: 400px;">
        <h2>ðŸ¤– Recipe AI</h2>
        <form id="chat-form">
            <textarea id="chat-input" name="message" placeholder="Ask the AI something..." style="width: 100%; height: 80px;"></textarea><br>
            <button type="submit">Send</button>
        </form>
        <div id="chat-output" style="margin-top: 20px; white-space: pre-wrap;"></div>
    </div>
</div>

<script>
document.getElementById('chat-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const input = document.getElementById('chat-input').value;
    const responseDiv = document.getElementById('chat-output');
    responseDiv.innerText = "Thinking...";

    const formData = new FormData();
    formData.append("message", input);

    const response = await fetch("/chat", {
        method: "POST",
        body: formData
    });

    const text = await response.text();
    responseDiv.innerText = text;
});
</script>

</body>
</html>
